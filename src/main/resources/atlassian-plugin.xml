<atlassian-plugin key="${atlassian.plugin.key}" name="${project.name}" plugins-version="2">
    <plugin-info>
        <description>${project.description}</description>
        <version>${project.version}</version>
        <vendor name="${project.organization.name}" url="${project.organization.url}" />
        <param name="plugin-icon">images/pluginIcon.png</param>
        <param name="plugin-logo">images/pluginLogo.png</param>
    </plugin-info>

    <!-- add our i18n resource -->
    <resource type="i18n" name="i18n" location="controlled-pm-for-confluence"/>
    
    <!-- add our web resources -->
    <web-resource key="controlledpm-resources" name="controlledpm Web Resources">
        <dependency>com.atlassian.auiplugin:ajs</dependency>
        <dependency>com.atlassian.confluence.plugins.confluence-create-content-plugin:resources</dependency>

        <!-- Added dependencies due to Confluence errors in the logs -->
        <dependency>com.atlassian.auiplugin:aui-experimental-soy</dependency>
        <dependency>confluence.extra.jira:web-resources-adg</dependency>

        <transformation extension="soy">
            <transformer key="soyTransformer">
                <functions>com.atlassian.confluence.plugins.soy:soy-core-functions
                </functions>
            </transformer>
        </transformation>
        
        <resource type="download" name="controlledpm.css" location="/css/controlledpm.css"/>
        <resource type="download" name="controlledpm.js" location="/js/controlledpm.js"/>
        <resource type="download" name="controlledpm-soy.js" location="/soy/controlledpm.soy" />
        <resource type="download" name="images/" location="/images"/>

        <context>controlled-pm-for-confluence</context>
        <!-- Added contexts for blueprint dialog wizard, otherwise soy templates cannot not found -->
        <context>atl.general</context>
        <context>atl.admin</context>
    </web-resource>
    <web-resource key="controlledpm-editor-resources" name="controlledpm Web Editor Resources">
        <description>controlledpm Web Editor Resources</description>
        <transformation extension="js">
            <transformer key="jsTransformer"/>
        </transformation>
        <resource name="controlled-pm-editor.js" type="download" location="js/controlledpmeditor.js"/>
        <context>editor</context>
    </web-resource>
    <web-resource key="editor-example-instructional-text-resources" name="Example Instruction Text Resources">
        <description>Example Instruction Text Resources</description>
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>
        <resource name="tinyMce-plugins-example-instructional-text.js" type="download" location="js/editor_plugin_src.js"/>
        <context>editor</context>
    </web-resource>

    <!--  Templates for Blueprint -->
    <content-template key="controlledpm-bptemplate-basic" template-title-key="controlledpm.blueprint.basic.title" i18n-name-key="controlledpm.blueprint.basic.title">
        <resource name="template" type="download" location="/bptemplates/basic.xml" />
    </content-template>
    <content-template key="controlledpm-bptemplate-advanced" template-title-key="controlledpm.blueprint.advanced.title" i18n-name-key="controlledpm.blueprint.advanced.title">
        <resource name="template" type="download" location="/bptemplates/advanced.xml" />
    </content-template>
    <content-template key="controlledpm-bptemplate-businesscase" template-title-key="controlledpm.blueprint.businesscase.title" i18n-name-key="controlledpm.blueprint.businesscase.title">
        <resource name="template" type="download" location="/bptemplates/businesscase.xml" />
        <context-provider class="com.davidkoudela.confluence.controlledpm.context.ControlledPMContextProvider"/>
    </content-template>

    <!--  Add to the Create Menu -->
    <web-item key="controlledpm-bptemplate-link" i18n-name-key="controlledpm.blueprint.link.title" section="system.create.dialog/content">
        <description key="controlledpm.blueprint.link.description"/>
        <resource name="icon" type="download" location="/images/blueprintIcon.png" />
        <param name="blueprintKey" value="controlledpm-blueprint" />
    </web-item>

    <!--  Blueprint -->
    <blueprint key="controlledpm-blueprint" index-key="controlledpm-index" i18n-name-key="controlledpm.blueprint.name">
        <content-template ref="controlledpm-bptemplate-basic"/>
        <content-template ref="controlledpm-bptemplate-advanced"/>
        <content-template ref="controlledpm-bptemplate-businesscase"/>
        <dialog-wizard key="controlledpm-wizard">
            <dialog-page id="page1Id" template-key="Controlledpm.Blueprints.page1Form"
                         title-key="controlledpm.blueprint.wizard.page1.title"
                         description-header-key="controlledpm.blueprint.wizard.page1.desc.header"
                         description-content-key="controlledpm.blueprint.wizard.page1.desc.content"
                         last="true"/>
        </dialog-wizard>
    </blueprint>

</atlassian-plugin>